<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
  <title>Live2D Cubism Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  
  <link rel="stylesheet" href="{{ url_for('static', filename='css/poppins.css') }}">

  <style>
    /* Styles de base */
    html, body {
      font-family: "Poppins", sans-serif;
      overflow: hidden;
      margin: 0;
    }
    html {
      overscroll-behavior-x: none;
      touch-action: none;
    }
    body {
      display: flex;
      justify-content: center;
      background-color: #F4EAD5 !important;
    }
    body > canvas:only-child {
      width: 100lvw;
      height: 100lvh;
    }
    canvas {
      position: absolute;
      top: 15px;
      max-width: 800px;
      height: calc(95vh - 72px - 60px);
      z-index: 0;
      background-color: #F4EAD5;
      transition: top 0.5s ease-out, height 0.5s ease-out;
    }
    canvas.keyboard-open {
      top: 0;
      height: 600px !important;
    }
    /* Bouton SVG pour l'envoi déjà existant */
    #svgSendIconBtn {
      background-color: #7E6363;
      -webkit-mask-image: url("{{ url_for('static', filename='icons/paper-plane-regular.svg') }}");
      mask-image: url("{{ url_for('static', filename='icons/paper-plane-regular.svg') }}");
      border: none;
    }
    .svgAudiIconBtn{
      background-color: #7E6363;
      -webkit-mask-image: url("{{ url_for('static', filename='icons/circle-play-regular.svg') }}");
      mask-image: url("{{ url_for('static', filename='icons/circle-play-regular.svg') }}");
      border: none;
    }
  </style>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div id="loading">Chargement...</div>

  <!-- Barre de navigation -->
  <ul class="nav nav-underline poppins-extrabold">
    <li class="nav-item active">
      <a class="nav-link active" aria-current="page" href="#">Home</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Chat</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Profil</a>
    </li>
    <!-- Élément ajouté à droite -->
    <li class="nav-item ml-auto">
      {% if current_user.is_authenticated %}
        <a class="nav-link" href="">
          <!-- Exemple d'émoticône SVG -->
          <svg class="emoticon-svg" width="24" height="24" fill="#C6698B" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke="none" />
            <circle cx="9" cy="10" r="1.5" fill="#fff" />
            <circle cx="15" cy="10" r="1.5" fill="#fff" />
            <path d="M8 15c1.333 1 2.667 1 4 0" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          </svg>
        </a>
      {% else %}
        <a class="nav-link poppins-semibold" href="{{ url_for('login') }}" style="color: #C6698B; font-size: 13px;">Se connecter</a>
      {% endif %}
    </li>
  </ul>

  <div class="chat-container">
    <!-- Zone de chat -->
    <div class="chat-area d-flex flex-column" id="chat-box">
      <div class="chat-gradient"></div>
      <div class="message-container">
        {% for message in messages %}
          <div class="d-flex flex-column {% if message.sender == current_user %}align-items-end{% else %}align-items-start{% endif %}">
            <div class="message {% if message.sender == current_user %}sent{% else %}received{% endif %}">
              <p class="mb-0">{{ message.text }}</p>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Formulaire d'envoi -->
    <div class="chat-input-wrapper">
      <form id="message-form" class="d-flex">
          <div class="input-container">
            <input type="text" name="message" id="message-input" class="chat-input poppins-medium" placeholder="Tapez votre message..." required>
            <div id="sendIconContainer" class="no-close-keyboard" onclick="sendMessage(event); return false;">
              <svg id="svgSendIconBtn" width="18" height="18"></svg>
            </div>
          </div>
      </form>
    </div>
  </div>

  <script src="{{ url_for('static', filename='lib/live2dcubismcore.min.js') }}"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>

  <script>
    document.getElementById('message-input').addEventListener('focus', function(e) {
      e.preventDefault();
      e.target.focus({ preventScroll: true });
    });

    let initialHeight = window.innerHeight;
    window.addEventListener('resize', () => {
      if (window.innerHeight < initialHeight - 100) {
        document.querySelector('canvas').classList.add('keyboard-open');
      } else {
        document.querySelector('canvas').classList.remove('keyboard-open');
        initialHeight = window.innerHeight;
      }
    });
  </script>
</body>
</html>
